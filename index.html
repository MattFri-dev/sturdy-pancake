<!DOCTYPE html>
<html>
<head>
  <title>GIBS GHRSST Layer Dates</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f0f8ff;
    }
    h2 {
      color: #003366;
    }
    .layer-date {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h2>Latest Imagery Dates from GIBS (GHRSST Layers)</h2>
  <div id="results">Loading...</div>

  <script>
    const layerNames = {
      "GHRSST_L4_MUR_Sea_Ice_Concentration": "Sea Ice Concentration (L4, MUR, GHRSST)",
      "GHRSST_L4_MUR_Sea_Surface_Temperature": "Sea Surface Temperature (L4, MUR Global Foundation, GHRSST)",
      "GHRSST_L4_MUR_Sea_Surface_Temperature_Anomaly": "Sea Surface Temperature Anomalies (L4, MUR, GHRSST)"
    };

    fetch("https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/WMTSCapabilities.xml")
      .then(response => response.text())
      .then(xmlText => {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "application/xml");

        const nsResolver = function(prefix) {
          const ns = {
            "ows": "http://www.opengis.net/ows/1.1",
            "wmts": "http://www.opengis.net/wmts/1.0"
          };
          return ns[prefix] || null;
        };

        const layers = xmlDoc.evaluate("//wmts:Layer", xmlDoc, nsResolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
        let output = "";

        for (let i = 0; i < layers.snapshotLength; i++) {
          const layer = layers.snapshotItem(i);
          const identifier = xmlDoc.evaluate("ows:Identifier", layer, nsResolver, XPathResult.STRING_TYPE, null).stringValue;
          const dimension = xmlDoc.evaluate("wmts:Dimension[@name='Time']", layer, nsResolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;

          if (layerNames[identifier] && dimension) {
            const defaultDate = dimension.getAttribute("default");
            output += `<div class="layer-date"><strong>${layerNames[identifier]}</strong>: ${defaultDate}</div>`;
          }
        }

        document.getElementById("results").innerHTML = output || "No matching layers found.";
      })
      .catch(err => {
        console.error("Error fetching WMTS capabilities:", err);
        document.getElementById("results").innerText = "Failed to load imagery dates.";
      });
  </script>
</body>
</html>
